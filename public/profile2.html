<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Overview</title>
  <link rel="shortcut icon" href="logo3.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body class="bg-gray-900">
<div class="min-h-screen bg-gray-900 text-white">

  <nav class="flex justify-between items-center p-4 border-b border-gray-800 sticky top-0 bg-gray-900">
    <a href="index.html" class="flex items-center hover:text-green-500">
        <img src="logo3.png" alt="NBA Logo" class="h-8 mr-2"> 
        <span class="text-xl font-semibold">NBA Guessing Game</span>
    </a>
    <div class="flex items-center">
      <a href="friends.html" class="ml-4 text-white hover:text-green-500">
        <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
          fill="currentColor" class="h-9 w-9" stroke="currentColor" viewBox="0 0 225.000000 225.000000"
          preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,225.000000) scale(0.100000,-0.100000)"
          fill="currentColor" stroke="currentColor">
          <path d="M515 1741 c-90 -22 -140 -80 -158 -185 -29 -170 61 -314 202 -324 92
          -7 167 42 210 138 23 51 28 168 10 235 -28 100 -151 163 -264 136z"/>
          <path d="M1605 1736 c-59 -17 -118 -75 -134 -132 -18 -66 -13 -183 10 -234 43
          -96 118 -145 211 -138 110 8 193 103 205 235 6 67 -16 159 -49 206 -43 60
          -152 88 -243 63z"/>
          <path d="M1040 1661 c-118 -38 -171 -125 -174 -281 -1 -105 20 -171 75 -233
          52 -60 109 -87 184 -87 75 0 132 27 184 87 55 62 76 128 75 233 -3 187 -82
          280 -243 286 -42 2 -87 0 -101 -5z"/>
          <path d="M329 1191 c-138 -54 -239 -194 -239 -332 l0 -36 103 -22 c88 -18 307
          -45 313 -38 1 1 16 31 33 65 65 129 185 224 339 268 8 2 2 18 -19 48 -24 34
          -42 47 -75 56 -41 12 -45 11 -74 -13 -35 -30 -82 -42 -158 -40 -57 1 -133 25
          -152 49 -15 17 -14 17 -71 -5z"/>
          <path d="M1448 1197 c-15 -7 -41 -31 -57 -54 l-30 -42 37 -12 c133 -42 255
          -144 312 -260 l32 -64 97 8 c53 4 146 18 206 30 l110 22 3 36 c4 48 -32 152
          -70 206 -17 23 -54 58 -82 78 -75 51 -176 82 -176 55 0 -24 -84 -50 -163 -50
          -80 0 -132 14 -156 43 -16 20 -26 20 -63 4z"/>
          <path d="M1298 1016 c-54 -75 -298 -75 -373 0 -16 16 -20 16 -70 0 -113 -35
          -216 -128 -265 -238 -20 -46 -47 -184 -37 -194 3 -3 38 -14 79 -24 246 -63
          578 -71 873 -20 188 32 195 35 195 73 0 47 -26 140 -56 198 -38 75 -112 144
          -197 184 -101 47 -128 51 -149 21z"/>
          </g>
        </svg>
      </a>
      <a href="/logout" class="flex items-center ml-4 text-sm font-medium hover:text-red-500">
        <svg fill="currentColor" class="h-5 w-5" stroke="currentColor" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
          viewBox="0 0 320.002 320.002" xml:space="preserve">
        <g id="XMLID_6_">
          <path id="XMLID_7_" d="M51.213,175.001h173.785c8.284,0,15-6.716,15-15c0-8.284-6.716-15-15-15H51.213l19.394-19.394
            c5.858-5.858,5.858-15.355,0-21.213c-5.857-5.858-15.355-5.858-21.213,0L4.396,149.393c-0.351,0.351-0.683,0.719-0.997,1.103
            c-0.137,0.167-0.256,0.344-0.385,0.515c-0.165,0.22-0.335,0.435-0.488,0.664c-0.14,0.209-0.261,0.426-0.389,0.64
            c-0.123,0.206-0.252,0.407-0.365,0.619c-0.118,0.22-0.217,0.446-0.323,0.67c-0.104,0.219-0.213,0.435-0.306,0.659
            c-0.09,0.219-0.164,0.442-0.243,0.664c-0.087,0.24-0.179,0.477-0.253,0.722c-0.067,0.222-0.116,0.447-0.172,0.672
            c-0.063,0.249-0.133,0.497-0.183,0.751c-0.051,0.259-0.082,0.521-0.119,0.782c-0.032,0.223-0.075,0.443-0.097,0.669
            c-0.048,0.484-0.073,0.971-0.074,1.457c0,0.007-0.001,0.015-0.001,0.022c0,0.007,0.001,0.015,0.001,0.022
            c0.001,0.487,0.026,0.973,0.074,1.458c0.022,0.223,0.064,0.44,0.095,0.661c0.038,0.264,0.069,0.528,0.121,0.79
            c0.05,0.252,0.119,0.496,0.182,0.743c0.057,0.227,0.107,0.456,0.175,0.681c0.073,0.241,0.164,0.474,0.248,0.71
            c0.081,0.226,0.155,0.453,0.247,0.675c0.091,0.22,0.198,0.431,0.3,0.646c0.108,0.229,0.21,0.46,0.33,0.685
            c0.11,0.205,0.235,0.4,0.354,0.599c0.131,0.221,0.256,0.444,0.4,0.659c0.146,0.219,0.309,0.424,0.466,0.635
            c0.136,0.181,0.262,0.368,0.407,0.544c0.299,0.364,0.616,0.713,0.947,1.048c0.016,0.016,0.029,0.034,0.045,0.05l45,45.001
            c2.93,2.929,6.768,4.394,10.607,4.394c3.838-0.001,7.678-1.465,10.606-4.393c5.858-5.858,5.858-15.355,0.001-21.213L51.213,175.001
            z"/>
          <path id="XMLID_8_" d="M305.002,25h-190c-8.284,0-15,6.716-15,15v60c0,8.284,6.716,15,15,15s15-6.716,15-15V55h160v210.001h-160
            v-45.001c0-8.284-6.716-15-15-15s-15,6.716-15,15v60.001c0,8.284,6.716,15,15,15h190c8.284,0,15-6.716,15-15V40
            C320.002,31.716,313.286,25,305.002,25z"/>
        </g>
        </svg>  
        <span class="ml-2">Logout</span>
      </a>

    </div>
</nav>



  

  <div class="flex flex-col md:flex-row w-full md:w-3/4 m-auto">

    <div class="flex-1 p-8">
      <div class="mb-4">
        <a href="index.html" class="bg-gray-800 text-white py-2 px-4 rounded hover:bg-gray-600 flex items-center">
          <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Game
        </a>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md text-center">
        <h2 class="text-2xl font-bold mb-4 ">Personal Information</h2>
        <img src="profile-pic.jpg" alt="User Avatar" class="rounded-full mx-auto w-20 h-20 mb-2 object-cover">
        <div class="mb-4">
          <label class="block inline">Name:</label>
          <div class="user-name inline"></div>
        </div>
        <div class="mb-4">
          <label class="block inline">Email:</label>
          <div class="inline"><span class="user-name"></span>@gmail.com</div>
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-center">Statistics</h2> 
        <div class="grid gap-4 grid-cols-2">
          <div>Games played:</div>
          <div id="games">0</div> 
          
          <div>Longest streak:</div>
          <div id="streakL">0</div> 

          <div>Current streak:</div>
          <div id="streakC">0</div> 

          <div>Win percentage:</div>
          <div id="win">0%</div> 
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-white">Guess distribution</h2>
        <div class="grid gap-4">
          <div class="w-full flex justify-center">
            <canvas id="myChart" class="max-w-full"></canvas>
          </div>
        </div>
      </div>



    </div>
  </div>

</div>

<script>

function resizeCanvas() {
  const canvas = document.getElementById('myChart');

  const heightRatio = 0.25;
  canvas.height = canvas.width * heightRatio;
}


resizeCanvas();


window.addEventListener('resize', resizeCanvas);

   
  
    function createChart(labels, data) {
  const chartData = {
    labels: labels,
    datasets: [{
      axis: 'y',
      label: 'Počet výherních her',
      data: data,
      fill: false,
      backgroundColor: 'rgb(67, 148, 108)',
      borderRadius: 10 
    }]
  };

  const config = {
    type: 'bar',
    data: chartData,
    options: {
      indexAxis: 'y',
      scales: {
        x: {
          display: false
        },
        y: {
          display: true,
          beginAtZero: true
        }
      },
      plugins: {
        legend: {
          display: false
        },
        datalabels: {
          display: true,
          color: 'white',
          anchor: 'end',
          align: 'right',
          offset: 0, // Offset from the end of the bar
        }
      }
    },
    plugins: [ChartDataLabels]
  };

  const ctx = document.getElementById('myChart').getContext('2d');
  if (window.myBarChart) {
    window.myBarChart.destroy();
  }
  window.myBarChart = new Chart(ctx, config);
}




</script>
<script>



  fetch('/get-user-info')
    .then(response => {
        if (response.ok) {
            return response.json();
        }

        if(response.status === 401 || response.status === 403) {
            console.log("není uživatel");

            window.location.href = '/login.html';
        }
        throw new Error('Network response was not ok.');
    })
    .then(data => {
        console.log('User Info:', data);

        const elements = document.querySelectorAll('.user-name');
        let idUser = data.id;


        elements.forEach(element => {
            element.textContent = data.username;
        });

        fetch(`http://localhost:3000/statistiky?userId=${idUser}`)
        .then(response => response.json())
        .then(data => {
          
            document.getElementById("games").textContent = data.PocetOdehranychHer;
            document.getElementById("streakL").textContent = data.LongestWinStreak;
            document.getElementById("streakC").textContent = data.CurrentWinStreak;
            document.getElementById("win").textContent = data.ProcentoVyhry.toFixed(2) + '%';
        })
        .catch(error => console.error('Error:', error));

        fetch(`http://localhost:3000/vyhry?userId=${idUser}`)
    .then(response => response.json())
    .then(data => {
      let chartData = Array(8).fill(0); 
        let labels = Array.from({length: 8}, (_, i) => (i + 1).toString()); 

        data.forEach(row => {
            const index = row.PokusUhodnuti - 1; 
            if (index >= 0 && index < chartData.length) {
                chartData[index] = row.PocetVyhranychHer;
            }
        });

        createChart(labels, chartData);

    })
    .catch(error => console.error('Error:', error));

    })
    .catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
    });
</script>
</body>
</html>
