<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Overview</title>
  <link rel="shortcut icon" href="logo3.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body class="bg-gray-900">
<div class="min-h-screen bg-gray-900 text-white">

  <nav class="flex justify-between items-center p-4 border-b border-gray-800 sticky top-0 bg-gray-900">
    <a href="index.html" class="flex items-center hover:text-green-500">
        <img src="logo3.png" alt="NBA Logo" class="h-8 mr-2"> 
        <span class="text-xl font-semibold">NBA Guessing Game</span>
    </a>
    <div class="flex items-center">
      <a href="friends.html" class="flex items-center ml-4 text-sm font-medium hover:text-green-500">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="37.6953" height="20.7324"> 
            <g> 
            <rect height="20.7324" opacity="0" width="37.6953" x="0" y="0"/> 
            <path d="M37.334 17.7734C37.334 18.8672 36.6699 19.4043 35.3418 19.4043L28.0919 19.4043C28.3734 18.9921 28.5153 18.5005 28.53 17.959L35.5859 17.959C35.791 17.959 35.8789 17.8809 35.8789 17.6855C35.8789 15.2637 33.1152 13.0078 29.9219 13.0078C28.7956 13.0078 27.7227 13.2884 26.809 13.7621C26.4986 13.3875 26.1381 13.0306 25.7333 12.6992C26.9229 11.99 28.3654 11.5625 29.9219 11.5625C34.0137 11.5625 37.334 14.5312 37.334 17.7734ZM33.584 6.42578C33.584 8.64258 31.9434 10.4492 29.9219 10.4492C27.9199 10.4492 26.2598 8.65234 26.2598 6.44531C26.2598 4.28711 27.9199 2.50977 29.9219 2.50977C31.9531 2.50977 33.584 4.25781 33.584 6.42578ZM27.7148 6.44531C27.7148 7.85156 28.7305 8.99414 29.9219 8.99414C31.123 8.99414 32.1387 7.85156 32.1387 6.42578C32.1387 5.04883 31.1523 3.96484 29.9219 3.96484C28.7207 3.96484 27.7148 5.06836 27.7148 6.44531Z" fill="currentColor" fill-opacity="0.85"/> 
            <path d="M11.598 12.7003C11.1942 13.0313 10.8344 13.3877 10.5245 13.7619C9.61097 13.2884 8.53826 13.0078 7.41211 13.0078C4.21875 13.0078 1.45508 15.2637 1.45508 17.6855C1.45508 17.8809 1.54297 17.959 1.74805 17.959L8.80394 17.959C8.81871 18.5005 8.9606 18.9921 9.24162 19.4043L1.98242 19.4043C0.664062 19.4043 0 18.8672 0 17.7734C0 14.5312 3.32031 11.5625 7.41211 11.5625C8.96558 11.5625 10.4078 11.9904 11.598 12.7003ZM11.084 6.42578C11.084 8.64258 9.43359 10.4492 7.42188 10.4492C5.41016 10.4492 3.75977 8.65234 3.75977 6.44531C3.75977 4.28711 5.41016 2.50977 7.42188 2.50977C9.45312 2.50977 11.084 4.25781 11.084 6.42578ZM5.21484 6.44531C5.21484 7.85156 6.2207 8.99414 7.42188 8.99414C8.62305 8.99414 9.63867 7.85156 9.63867 6.42578C9.63867 5.04883 8.65234 3.96484 7.42188 3.96484C6.21094 3.96484 5.21484 5.06836 5.21484 6.44531Z" fill="currentColor" fill-opacity="0.85"/> 
            <path d="M18.6719 10.3613C20.9961 10.3613 22.8906 8.30078 22.8906 5.78125C22.8906 3.28125 21.0059 1.31836 18.6719 1.31836C16.3477 1.31836 14.4531 3.32031 14.4531 5.80078C14.4531 8.31055 16.3477 10.3613 18.6719 10.3613ZM18.6719 8.88672C17.2461 8.88672 16.0254 7.5293 16.0254 5.80078C16.0254 4.10156 17.2168 2.79297 18.6719 2.79297C20.127 2.79297 21.3184 4.07227 21.3184 5.78125C21.3184 7.50977 20.1074 8.88672 18.6719 8.88672ZM12.5293 19.4043L24.7949 19.4043C26.4258 19.4043 27.1973 18.916 27.1973 17.8418C27.1973 15.2832 23.9648 11.582 18.6621 11.582C13.3691 11.582 10.1367 15.2832 10.1367 17.8418C10.1367 18.916 10.9082 19.4043 12.5293 19.4043ZM12.0605 17.9297C11.8066 17.9297 11.709 17.8613 11.709 17.6562C11.709 16.0449 14.1895 13.0566 18.6621 13.0566C23.1445 13.0566 25.625 16.0449 25.625 17.6562C25.625 17.8613 25.5176 17.9297 25.2637 17.9297Z" fill="currentColor" fill-opacity="0.85"/> 
            </g> 
        </svg>
          <span class="ml-2">Friends</span>
        </a>
        <a href="/logout" class="flex items-center ml-4 text-sm font-medium hover:text-red-500">
          <svg id="logout" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="17.6953" height="26.4746"> 
            <g> 
                <rect height="26.4746" opacity="0" width="17.6953" x="0" y="0"/> 
                <path d="M17.334 10.7617L17.334 20.5078C17.334 22.5195 16.3086 23.5352 14.2676 23.5352L3.06641 23.5352C1.02539 23.5352 0 22.5195 0 20.5078L0 10.7617C0 8.75 1.02539 7.73438 3.06641 7.73438L6.00586 7.73438L6.00586 9.30664L3.08594 9.30664C2.10938 9.30664 1.57227 9.83398 1.57227 10.8496L1.57227 20.4199C1.57227 21.4355 2.10938 21.9629 3.08594 21.9629L14.2383 21.9629C15.2051 21.9629 15.7617 21.4355 15.7617 20.4199L15.7617 10.8496C15.7617 9.83398 15.2051 9.30664 14.2383 9.30664L11.3281 9.30664L11.3281 7.73438L14.2676 7.73438C16.3086 7.73438 17.334 8.75 17.334 10.7617Z" fill="currentColor" fill-opacity="0.85"/> 
                <path d="M8.66211 15.8887C9.08203 15.8887 9.44336 15.5371 9.44336 15.127L9.44336 5.09766L9.38477 3.63281L10.0391 4.32617L11.5234 5.9082C11.6602 6.06445 11.8555 6.14258 12.0508 6.14258C12.4512 6.14258 12.7637 5.84961 12.7637 5.44922C12.7637 5.24414 12.6758 5.08789 12.5293 4.94141L9.22852 1.75781C9.0332 1.5625 8.86719 1.49414 8.66211 1.49414C8.4668 1.49414 8.30078 1.5625 8.0957 1.75781L4.79492 4.94141C4.64844 5.08789 4.57031 5.24414 4.57031 5.44922C4.57031 5.84961 4.86328 6.14258 5.27344 6.14258C5.45898 6.14258 5.67383 6.06445 5.81055 5.9082L7.28516 4.32617L7.94922 3.63281L7.89062 5.09766L7.89062 15.127C7.89062 15.5371 8.24219 15.8887 8.66211 15.8887Z" fill="currentColor" fill-opacity="0.85"/> 
            </g> 
          </svg> 
        <span class="ml-2">Logout</span>
      </a>

    </div>
</nav>

  <div class="flex flex-col md:flex-row w-full md:w-3/4 m-auto">

    <div class="flex-1 p-8">
      <div class="mb-4">
        <a href="friends.html" class="bg-gray-800 text-white py-2 px-4 rounded hover:bg-gray-600 flex items-center">
            <svg class="mr-2" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="22.3047" height="17.9199"> 
                <g>
                <rect height="17.9199" opacity="0" width="22.3047" x="0" y="0"/>
                <path d="M9.54102 17.9102C10.2051 17.9102 10.6836 17.4219 10.6836 16.7676L10.6836 13.0371L10.9668 13.0371C14.7559 13.0371 17.1387 13.9941 18.8477 17.1875C19.1895 17.8125 19.6387 17.9102 20.0488 17.9102C20.5664 17.9102 21.0547 17.4414 21.0547 16.6016C21.0547 9.38477 17.998 4.88281 10.9668 4.88281L10.6836 4.88281L10.6836 1.19141C10.6836 0.537109 10.2051 0 9.52148 0C9.04297 0 8.7207 0.205078 8.20312 0.693359L0.498047 7.90039C0.117188 8.26172 0 8.62305 0 8.95508C0 9.27734 0.126953 9.64844 0.498047 10L8.20312 17.2754C8.67188 17.7148 9.0625 17.9102 9.54102 17.9102ZM8.98438 15.8105C8.92578 15.8105 8.86719 15.7812 8.81836 15.7227L1.85547 9.14062C1.77734 9.0625 1.74805 9.01367 1.74805 8.95508C1.74805 8.89648 1.77734 8.83789 1.85547 8.76953L8.80859 2.09961C8.85742 2.06055 8.91602 2.02148 8.97461 2.02148C9.0625 2.02148 9.11133 2.08008 9.11133 2.1582L9.11133 6.03516C9.11133 6.25977 9.21875 6.35742 9.44336 6.35742L10.752 6.35742C17.4512 6.35742 19.4727 11.0059 19.668 15.6152C19.668 15.6934 19.6387 15.7227 19.5898 15.7227C19.5508 15.7227 19.5312 15.6934 19.502 15.625C18.3496 13.1738 15.3906 11.5625 10.752 11.5625L9.44336 11.5625C9.21875 11.5625 9.11133 11.6602 9.11133 11.8848L9.11133 15.6641C9.11133 15.752 9.0625 15.8105 8.98438 15.8105Z" fill="currentColor" fill-opacity="0.85"/> 
                </g> 
            </svg>
          Back to Friends
        </a>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md text-center">
        <h2 class="text-2xl font-bold mb-4 ">Personal Information</h2>
        <div class="profile-photo-container flex flex-col items-center justify-center">
          <label for="profile_photo" class="w-20 h-20 border-2 border-transparent rounded-full overflow-hidden bg-gray-700 flex justify-center items-center">
              <img id="profile_photo_preview"  alt="User Avatar" class="object-cover rounded-full w-full h-full">
          </label>
      </div>
        <div class="mb-4">
          <label class="inline">Name:</label>
          <div class="user-name inline"></div>
        </div>
        <div class="mb-4">
          <label class="inline">Email:</label>
          <div class="inline email"></div>
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-center">Unlimited Statistics</h2> 
        <div class="grid gap-4 grid-cols-2">
          <div>Games played:</div>
          <div id="games">0</div> 
          
          <div>Longest streak:</div>
          <div id="streakL">0</div> 

          <div>Current streak:</div>
          <div id="streakC">0</div> 

          <div>Win percentage:</div>
          <div id="win">0%</div> 
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-center">Daily Statistics</h2> 
        <div class="grid gap-4 grid-cols-2">
          <div>Games played:</div>
          <div id="gamesDaily">0</div> 
          
          <div>Longest streak:</div>
          <div id="streakLDaily">0</div> 

          <div>Current streak:</div>
          <div id="streakCDaily">0</div> 

          <div>Win percentage:</div>
          <div id="winDaily">0%</div> 
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-center">Rapid Fire Statistics</h2> 
        <div class="grid gap-4 grid-cols-2">
            <div>Games Played:</div>
            <div id="gamesPlayed">0</div> 
            
            <div>Total score:</div>
            <div id="correctGuesses">0</div> 
    
            <div>Best score:</div>
            <div id="maxCorrectGuesses">0</div> 
    
            <div>Average score:</div>
            <div id="avgCorrectGuesses">0</div> 
        </div>
    </div>

      <div class="bg-gray-800 p-6 rounded-lg shadow-md mt-8 text-center">
        <h2 class="text-2xl font-bold mb-4 text-white">Guess distribution for Unlimited</h2>
        <div class="grid gap-4">
          <div class="w-full flex justify-center">
            <canvas id="myChart" class="max-w-full"></canvas>
          </div>
        </div>
      </div>



    </div>
  </div>

</div>

<script>

function resizeCanvas() {
  const canvas = document.getElementById('myChart');

  const heightRatio = 0.25;
  canvas.height = canvas.width * heightRatio;
}


resizeCanvas();


window.addEventListener('resize', resizeCanvas);

   
  
    function createChart(labels, data) {
  const chartData = {
    labels: labels,
    datasets: [{
      axis: 'y',
      label: 'Počet výherních her',
      data: data,
      fill: false,
      backgroundColor: 'rgb(67, 148, 108)',
      borderRadius: 10 
    }]
  };

  const config = {
    type: 'bar',
    data: chartData,
    options: {
      indexAxis: 'y',
      scales: {
        x: {
          display: false
        },
        y: {
          display: true,
          beginAtZero: true
        }
      },
      plugins: {
        legend: {
          display: false
        },
        datalabels: {
          display: true,
          color: 'white',
          anchor: 'end',
          align: 'right',
          offset: 0,
        }
      }
    },
    plugins: [ChartDataLabels]
  };

  const ctx = document.getElementById('myChart').getContext('2d');
  if (window.myBarChart) {
    window.myBarChart.destroy();
  }
  window.myBarChart = new Chart(ctx, config);
}




</script>
<script>



  fetch('/get-user-info')
    .then(response => {
        if (response.ok) {
            return response.json();
        }

        if(response.status === 500 || response.status === 401 || response.status === 403) {
            console.log("není uživatel");

            window.location.href = '/login.html';
        }
        throw new Error('Network response was not ok.');
    })
    .then(data => {
        const url = window.location.href;

        const urlParams = new URLSearchParams(new URL(url).search);

        const friendId = urlParams.get('user_id');

        setInterval(checkUser, 300000);

        fetch(`/friend_info?userId=${friendId}`)
        .then(response => response.json())
        .then(data => {
            console.log('User Info:', data);

            const elements = document.querySelectorAll('.user-name');

            const email = data.Email;
            const emailElements = document.querySelectorAll('.email');

            emailElements.forEach(element => {
                element.textContent = email;
            });

            elements.forEach(element => {
                element.textContent = data.Username;
            });
            
        });

        fetch(`/profile-picture?userId=${friendId}`)
        .then(response => {
            if (response.ok) {
                return response.blob();
            }
            throw new Error('Network response was not ok.');
        })
        .then(blob => {
            const url = URL.createObjectURL(blob);
            const profilePhoto = document.getElementById('profile_photo_preview');
            profilePhoto.src = url;
        })
        .catch(error => {
            console.error('Error:', error);
        });

        fetch(`http://localhost:3000/statistiky?userId=${friendId}`)
        .then(response => response.json())
        .then(data => {
          
            document.getElementById("games").textContent = data.PocetOdehranychHer;
            document.getElementById("streakL").textContent = data.LongestWinStreak;
            document.getElementById("streakC").textContent = data.CurrentWinStreak;
            document.getElementById("win").textContent = data.ProcentoVyhry.toFixed(2) + '%';
        })
        .catch(error => console.error('Error:', error));

        fetch(`http://localhost:3000/dailyStats?userId=${friendId}`)
        .then(response => response.json())
        .then(data => {
          
            document.getElementById("gamesDaily").textContent = data.PocetOdehranychHer;
            document.getElementById("streakLDaily").textContent = data.LongestWinStreak;
            document.getElementById("streakCDaily").textContent = data.CurrentWinStreak;
            document.getElementById("winDaily").textContent = data.ProcentoVyhry.toFixed(2) + '%';
        })
        .catch(error => console.error('Error:', error));

        fetch(`http://localhost:3000/user-rapid-stats?user_id=${friendId}`)
        .then(response => response.json())
        .then(data => {
          
            document.getElementById('correctGuesses').textContent = data.total_correct_guesses;
            document.getElementById('gamesPlayed').textContent = data.games_played;
            document.getElementById('maxCorrectGuesses').textContent = data.max_correct_guesses;
            document.getElementById('avgCorrectGuesses').textContent = data.avg_correct_guesses.toFixed(2);
        })
        .catch(error => console.error('Error:', error));

        fetch(`http://localhost:3000/vyhry?userId=${friendId}`)
    .then(response => response.json())
    .then(data => {
      let chartData = Array(8).fill(0); 
        let labels = Array.from({length: 8}, (_, i) => (i + 1).toString()); 

        data.forEach(row => {
            const index = row.PokusUhodnuti - 1; 
            if (index >= 0 && index < chartData.length) {
                chartData[index] = row.PocetVyhranychHer;
            }
        });

        createChart(labels, chartData);

    })
    .catch(error => console.error('Error:', error));

    })
    .catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
    });

    function checkUser() {
        fetch('/get-user-info')
        .then(response => {
            if (response.ok) {
                return;
            }

            if (response.status === 500 || response.status === 401 || response.status === 403) {
                console.log("není uživatel");
                window.location.href = '/login.html';
            }
            throw new Error('Network response was not ok.');
        })
        .catch(error => {
            console.error('There has been a problem with your fetch operation:', error);
        });
    }
</script>
</body>
</html>
